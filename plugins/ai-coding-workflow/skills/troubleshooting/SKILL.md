---
name: troubleshooting
description: 問題排查工作流程。使用時機：問題、錯誤、bug、修復、除錯、debug。提供結構化的四階段流程，快速定位和解決問題。
---

# Troubleshooting Skill

問題排查專用 skill，處理踩坑案例、除錯流程、錯誤分析等任務。

**觸發關鍵字**：問題、錯誤、bug、修復、除錯、debug

---

## Phase 1: 任務理解

**目標**：確保正確理解問題，收集足夠上下文

### 執行步驟

1. **調用 detect-context**：偵測專案技術棧以便對照相關踩坑案例

   ```
   Task tool:
     subagent_type: ai-coding-workflow:detect-context
     prompt: "偵測當前專案的技術棧以對照踩坑案例"
   ```

   如果偵測失敗，使用 AskUserQuestion 詢問用戶

2. **重述問題**：用自己的話重述用戶遇到的問題

3. **收集資訊**：
   - 錯誤訊息
   - 重現步驟
   - 預期行為 vs 實際行為

4. **判斷問題類型**：確認是哪類問題（執行錯誤、邏輯錯誤、配置問題）

5. **提出問題**：如有不確定的地方，提出問題

### 輸出格式

```markdown
## 問題理解

### 專案上下文

- **技術棧**: [偵測到的技術棧]
- **相關踩坑案例**: [可能相關的案例]

### 問題重述

[用自己的話重述問題]

### 收集的資訊

- **錯誤訊息**: [錯誤訊息]
- **重現步驟**: [步驟]
- **預期行為**: [預期]
- **實際行為**: [實際]

### 確認問題（如有）

1. [問題 1]
2. [問題 2]
```

---

## Phase 2: 任務規劃

**目標**：建立除錯計畫，獲得用戶確認

### 執行步驟

1. **判斷複雜度**：根據影響範圍判斷 High/Medium/Low

   | 複雜度 | 判斷標準                           |
   | ------ | ---------------------------------- |
   | High   | 跨多個模組、需要設計決策、影響架構 |
   | Medium | 單一模組內、有既定模式可循         |
   | Low    | 單一檔案、小幅修改、有明確範例     |

2. **讀取參考文件**：
   - `references/index.md` - 踩坑案例索引
   - `references/prompt-cheatsheet.md` - Prompt 速查表

3. **檢查已知踩坑**：是否有類似的已記錄案例

4. **制定除錯計畫**：列出具體步驟

5. **評估風險**：識別潛在問題

### 輸出格式

```markdown
## 除錯規劃

**問題類型**: [執行錯誤 / 邏輯錯誤 / 配置問題]
**複雜度**: [High / Medium / Low]

### 相關踩坑案例

- [案例名稱]：[相關性說明]

### 除錯計畫

| 步驟 | 動作       | 參考文件       |
| ---- | ---------- | -------------- |
| 1    | [具體動作] | [相關參考文件] |
| 2    | [具體動作] | [相關參考文件] |
| 3    | [具體動作] | [相關參考文件] |

### 風險評估

- [風險 1]：[緩解措施]
- [風險 2]：[緩解措施]

---

**WAITING FOR CONFIRMATION**

請確認除錯計畫：

- `yes` - 開始除錯
- `modify` - 修改計畫
- `cancel` - 取消
```

### 關鍵：WAIT FOR CONFIRMATION

**Phase 2 結束後，必須等待用戶確認才能進入 Phase 3。**

- 不要自動繼續執行
- 使用 AskUserQuestion 或等待用戶回覆
- 如果用戶選擇 `modify`，根據反饋調整計畫

---

## Phase 3: 任務執行

**目標**：按計畫除錯，更新進度

### 讀取參考文件

根據問題類型讀取相關踩坑案例：

| 技術棧 | 參考文件                                     |
| ------ | -------------------------------------------- |
| CI/CD  | `references/case-01-cicd-configuration.md`   |
| Astro  | `references/case-02-astro5-env-variables.md` |
| Vercel | `references/case-03-vercel-api-404.md`       |

### Prompts 目錄

- `references/prompts/bug-fixing.md` - Bug 修復

### 除錯流程

1. **重現問題**：確認可以穩定重現
2. **縮小範圍**：找到最小重現案例
3. **分析原因**：找到根本原因
4. **修復問題**：應用修復
5. **驗證修復**：確認問題已解決

### 執行步驟

1. **必須讀取對應的 prompt 檔案**：根據任務類型讀取 `references/prompts/` 下的對應檔案
2. **閱讀「變數說明」區塊**：了解每個 `${...}` 變數的來源和範例
3. **替換所有變數**：將 `${...}` 替換為實際值，無法取得時詢問用戶
4. **按照 prompt 範本格式輸出**：遵循範本定義的結構
5. **更新進度**：每完成一個步驟，更新狀態
6. **遇到問題時**：說明問題，詢問用戶意見

### 進度更新格式

```markdown
## 除錯進度

| 步驟 | 狀態      | 備註       |
| ---- | --------- | ---------- |
| 1    | ✅ 完成   | [完成內容] |
| 2    | 🔄 進行中 | [當前進度] |
| 3    | ⏸️ 待執行 |            |
```

### 執行原則

1. **不要猜測**：基於證據除錯，不要靠猜
2. **保留上下文**：記錄嘗試過的方法
3. **最小修改**：只修改必要的部分
4. **及時回報**：遇到問題立即回報，不要自行決定跳過

---

## Phase 4: 驗收與交付

**目標**：確認問題已修復，記錄經驗

### 70% MVP 標準（問題排查類）

| 項目     | MVP 包含          | 人工迭代   |
| -------- | ----------------- | ---------- |
| 問題定位 | ✅ 根本原因已找到 | 深入分析   |
| 修復     | ✅ 問題已修復     | 防禦性修復 |
| 驗證     | ✅ 修復已驗證     | 回歸測試   |
| 文檔     | ⏸️ 基本記錄       | 踩坑案例   |

### MVP 檢查清單

- [ ] 問題已重現
- [ ] 根本原因已找到
- [ ] 修復已應用
- [ ] 修復已驗證
- [ ] 無其他副作用

### 輸出格式

```markdown
## 問題已修復

### 問題摘要

- **問題**: [問題描述]
- **根本原因**: [根本原因]
- **修復方式**: [修復方式]

### 修改清單

| 類型 | 檔案路徑  | 修改說明 |
| ---- | --------- | -------- |
| 修復 | `src/...` | [說明]   |

### MVP 檢查

- [x] 問題已重現
- [x] 根本原因已找到
- [x] 修復已應用
- [x] 修復已驗證
- [x] 無其他副作用

### 經驗記錄

**是否值得記錄為踩坑案例？**

- [ ] 是 - 建議新增到 `appendix/pitfalls/`
- [ ] 否 - 問題較為特定

### 後續建議

1. [建議 1]
2. [建議 2]

---

**問題已修復，請驗證後告訴我是否還有其他問題。**
```

---

## 快速參考

### 常見場景 → 文件對應

| 場景     | 讀取                 | 執行                  |
| -------- | -------------------- | --------------------- |
| Bug 修復 | index.md             | prompts/bug-fixing.md |
| 已知踩坑 | case-\*.md           | 套用已記錄的解決方案  |
| 未知問題 | prompt-cheatsheet.md | prompts/bug-fixing.md |

---

## 變數系統

使用變數語法，需替換為實際技術棧：

```
${PROJECT_NAME}     - 專案名稱
${FRAMEWORK}        - 框架（Vue 3、React、FastAPI）
${ERROR_MESSAGE}    - 錯誤訊息
${ENVIRONMENT}      - 環境（development、production）
```
