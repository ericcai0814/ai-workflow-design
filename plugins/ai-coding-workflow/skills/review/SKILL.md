---
name: review
description: 程式碼審查工作流程。使用時機：程式碼審查、review、安全審查、效能審查、code review。提供結構化的四階段流程，確保程式碼品質。
---

# Review Skill

程式碼審查專用 skill，處理程式碼審查、安全審查、效能審查等任務。

**觸發關鍵字**：程式碼審查、review、安全審查、效能審查、code review

---

## Phase 1: 任務理解

**目標**：確保正確理解用戶需求，避免誤解

### 執行步驟

1. **調用 detect-context**：偵測專案程式碼規範、lint 設定

   ```
   Task tool:
     subagent_type: ai-coding-workflow:detect-context
     prompt: "偵測當前專案的程式碼規範和 lint 設定"
   ```

   如果偵測失敗，使用 AskUserQuestion 詢問用戶

2. **重述需求**：用自己的話重述用戶的任務

3. **列出假設**：列出執行此任務的假設

4. **判斷任務類型**：確認是審查類任務（程式碼審查、安全審查、效能審查）

5. **提出問題**：如有不確定的地方，提出問題

### 輸出格式

```markdown
## 任務理解

### 專案上下文

- **Linter**: [ESLint / Prettier / ...]
- **程式碼規範**: [Airbnb / Standard / ...]
- **審查範圍**: [PR / 特定檔案 / 全專案]

### 需求重述

[用自己的話重述用戶的需求]

### 假設

- [ ] 假設 1
- [ ] 假設 2
- [ ] 假設 3

### 確認問題（如有）

1. [問題 1]
2. [問題 2]
```

---

## Phase 2: 任務規劃

**目標**：建立執行計畫，獲得用戶確認

### 執行步驟

1. **判斷複雜度**：根據影響範圍判斷 High/Medium/Low

   | 複雜度 | 判斷標準                           |
   | ------ | ---------------------------------- |
   | High   | 跨多個模組、需要設計決策、影響架構 |
   | Medium | 單一模組內、有既定模式可循         |
   | Low    | 單一檔案、小幅修改、有明確範例     |

2. **讀取參考文件**：
   - `references/overview.md` - 審核階段總覽
   - `references/code-review-checklist.md` - 程式碼審查清單

3. **制定執行計畫**：列出具體步驟

4. **評估風險**：識別潛在問題

### 輸出格式

```markdown
## 任務規劃

**任務類型**: 審查
**複雜度**: [High / Medium / Low]

### 執行計畫

| 步驟 | 動作       | 參考文件       |
| ---- | ---------- | -------------- |
| 1    | [具體動作] | [相關參考文件] |
| 2    | [具體動作] | [相關參考文件] |
| 3    | [具體動作] | [相關參考文件] |

### 風險評估

- [風險 1]：[緩解措施]
- [風險 2]：[緩解措施]

---

**WAITING FOR CONFIRMATION**

請確認執行計畫：

- `yes` - 開始執行
- `modify` - 修改計畫
- `cancel` - 取消
```

### 關鍵：WAIT FOR CONFIRMATION

**Phase 2 結束後，必須等待用戶確認才能進入 Phase 3。**

- 不要自動繼續執行
- 使用 AskUserQuestion 或等待用戶回覆
- 如果用戶選擇 `modify`，根據反饋調整計畫

---

## Phase 3: 任務執行

**目標**：按計畫執行，更新進度

### 讀取參考文件

根據審查任務類型讀取：

| 審查任務   | 參考文件                                          |
| ---------- | ------------------------------------------------- |
| 程式碼審查 | `references/code-review-checklist.md`             |
| 安全審查   | `references/code-review-checklist.md`（安全部分） |
| 效能審查   | `references/code-review-checklist.md`（效能部分） |

### Prompts 目錄

- `references/prompts/review-code.md` - 程式碼審查

### 審查清單重點

| 類別 | 檢查項目                |
| ---- | ----------------------- |
| 功能 | 邏輯正確、邊界處理      |
| 安全 | 輸入驗證、SQL 注入、XSS |
| 效能 | N+1 查詢、記憶體洩漏    |
| 可讀 | 命名清晰、結構合理      |
| 測試 | 覆蓋率足夠、邊界案例    |

### 執行步驟

1. **按步驟執行**：遵循 Phase 2 制定的計畫
2. **更新進度**：每完成一個步驟，更新狀態
3. **遇到問題時**：說明問題，詢問用戶意見

### 進度更新格式

```markdown
## 執行進度

| 步驟 | 狀態      | 備註       |
| ---- | --------- | ---------- |
| 1    | ✅ 完成   | [完成內容] |
| 2    | 🔄 進行中 | [當前進度] |
| 3    | ⏸️ 待執行 |            |
```

### 執行原則

1. **遵循審查清單**：按 code-review-checklist.md 逐項檢查
2. **標註嚴重程度**：Critical / High / Medium / Low
3. **提供修復建議**：每個問題都附上修復建議
4. **及時回報**：遇到問題立即回報，不要自行決定跳過

---

## Phase 4: 驗收與交付

**目標**：確認審查完成，交付審查報告

### 70% MVP 標準（審查類）

| 項目     | MVP 包含        | 人工迭代 |
| -------- | --------------- | -------- |
| 功能審查 | ✅ 核心邏輯檢查 | 邊界案例 |
| 安全審查 | ✅ OWASP Top 10 | 深度滲透 |
| 效能審查 | ✅ 明顯問題     | 效能測試 |
| 可讀性   | ✅ 命名、結構   | 架構優化 |

### MVP 檢查清單

- [ ] 功能邏輯已審查
- [ ] 安全問題已標註
- [ ] 效能問題已識別
- [ ] 可讀性問題已列出
- [ ] 修復建議已提供

### 輸出格式

```markdown
## 審查完成

### 審查摘要

| 嚴重程度 | 數量 |
| -------- | ---- |
| Critical | N    |
| High     | N    |
| Medium   | N    |
| Low      | N    |

### 問題清單

#### Critical

- [ ] [問題描述] - [修復建議]

#### High

- [ ] [問題描述] - [修復建議]

#### Medium

- [ ] [問題描述] - [修復建議]

#### Low

- [ ] [問題描述] - [修復建議]

### MVP 檢查

- [x] 功能邏輯已審查
- [x] 安全問題已標註
- [x] 效能問題已識別
- [x] 可讀性問題已列出
- [x] 修復建議已提供

### 後續建議

1. [建議 1]
2. [建議 2]

---

**審查已完成，請根據問題清單進行修復。**
```

---

## 快速參考

### 常見場景 → 文件對應

| 場景     | 讀取                     | 執行                   |
| -------- | ------------------------ | ---------------------- |
| PR 審查  | code-review-checklist.md | prompts/review-code.md |
| 安全審查 | code-review-checklist.md | prompts/review-code.md |
| 效能審查 | code-review-checklist.md | prompts/review-code.md |

---

## 變數系統

使用變數語法，需替換為實際技術棧：

```
${PROJECT_NAME}     - 專案名稱
${LINTER}           - Linter（ESLint、Prettier）
${CODE_STYLE}       - 程式碼規範（Airbnb、Standard）
${REVIEW_SCOPE}     - 審查範圍（PR、檔案路徑）
```
